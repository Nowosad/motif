<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial patterns' clustering • motif</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial patterns' clustering">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">motif</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v1_intro.html">Introduction to the motif package</a>
    </li>
    <li>
      <a href="../articles/v2_signatures.html">Types of spatial patterns' signatures</a>
    </li>
    <li>
      <a href="../articles/v3_search.html">Spatial patterns' search</a>
    </li>
    <li>
      <a href="../articles/v4_compare.html">Spatial patterns' comparision</a>
    </li>
    <li>
      <a href="../articles/v5_cluster.html">Spatial patterns' clustering</a>
    </li>
    <li>
      <a href="../articles/v6_composition.html">Extracting the proportion of different classes in many regular local landscapes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nowosad/motif/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial patterns’ clustering</h1>
                        <h4 data-toc-skip class="author">Jakub
Nowosad</h4>
            
            <h4 data-toc-skip class="date">2025-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/motif/blob/main/vignettes/articles/v5_cluster.Rmd" class="external-link"><code>vignettes/articles/v5_cluster.Rmd</code></a></small>
      <div class="hidden name"><code>v5_cluster.Rmd</code></div>

    </div>

    
    
<p>The pattern-based spatial analysis makes it possible to find clusters
of areas with similar spatial patterns. This vignette shows how to do
spatial patterns’ clustering on example datasets. Let’s start by
attaching necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/motif/" class="external-link">motif</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: abind</span></span>
<span><span class="co">#&gt; Loading required package: sf</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">safe_pal6</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#88CCEE"</span>, <span class="st">"#CC6677"</span>, <span class="st">"#DDCC77"</span>,</span>
<span>             <span class="st">"#117733"</span>, <span class="st">"#332288"</span>, <span class="st">"#888888"</span><span class="op">)</span></span>
<span><span class="va">safe_pal4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#88CCEE"</span>, <span class="st">"#CC6677"</span>, <span class="st">"#DDCC77"</span>, <span class="st">"#117733"</span><span class="op">)</span></span></code></pre></div>
<p>Spatial patterns’ clustering requires one spatial object. For this
vignette, we will read the <code>"raster/landcover2015.tif"</code>
file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/landcover2015.tif"</span>, package <span class="op">=</span> <span class="st">"motif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This file contains a land cover data for New Guinea, with seven
possible categories: (1) agriculture, (2) forest, (3) grassland, (5)
settlement, (6) shrubland, (7) sparse vegetation, and (9) water.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/factors.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">landcover</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover</span>, key.pos <span class="op">=</span> <span class="fl">4</span>, key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">lcm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, main <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; downsample set to 12</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="section level2">
<h2 id="regular-local-landscapes">Regular local landscapes<a class="anchor" aria-label="anchor" href="#regular-local-landscapes"></a>
</h2>
<p>In the first example, we divide the whole area into many regular
local landscapes, and find a way to cluster them based on their
patterns.</p>
<pre><code><span><span class="co">#&gt; downsample set to 12</span></span></code></pre>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>It starts with calculating a signature for each local landscape using
the <code><a href="../reference/lsp_signature.html">lsp_signature()</a></code> function. Here, we use the
co-occurrence vector (<code>type = "cove"</code>) representation on
local landscapes of 100 by 100 cells (<code>window = 100</code>).
Distance measures, used in one of the next steps, often require
normalization of the vector, therefore we transform the representation
to sum to one.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_cove</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_signature.html">lsp_signature</a></span><span class="op">(</span><span class="va">landcover</span>, type <span class="op">=</span> <span class="st">"cove"</span>,</span>
<span>                                window <span class="op">=</span> <span class="fl">100</span>, normalization <span class="op">=</span> <span class="st">"pdf"</span><span class="op">)</span></span></code></pre></div>
<p>Read the <a href="https://nowosad.github.io/motif/articles/v1_intro.html" class="external-link">Introduction
to the motif package</a> vignette to learn more about spatial
signatures.</p>
<p>Next, we need to calculate the distance (dissimilairy) between each
local landscape’s pattern. This can be done with the
<code><a href="../reference/lsp_to_dist.html">lsp_to_dist()</a></code> function, where we must provide the output of
<code><a href="../reference/lsp_signature.html">lsp_signature()</a></code> and a distance/dissimilarity measure used
(<code>dist_fun = "jensen-shannon"</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_dist</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_to_dist.html">lsp_to_dist</a></span><span class="op">(</span><span class="va">landcover_cove</span>, dist_fun <span class="op">=</span> <span class="st">"jensen-shannon"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Metric: 'jensen-shannon' using unit: 'log2'; comparing: 1080 vectors.</span></span></code></pre></div>
<p>The output, <code>landcover_dist</code>, is of a <code>dist</code>
class.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">landcover_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dist"</span></span></code></pre></div>
<p>This allows it to be used by many existing R functions for
clustering, which expect a distance matrix (<code>dist</code>) as an
input. It includes different approaches of hierarchical clustering
(<code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust()</a></code>, <code><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">cluster::agnes()</a></code>,
<code><a href="https://rdrr.io/pkg/cluster/man/diana.html" class="external-link">cluster::diana()</a></code>) or fuzzy clustering
(<code><a href="https://rdrr.io/pkg/cluster/man/fanny.html" class="external-link">cluster::fanny()</a></code>). More information about clustering
techniques in R can be found in <a href="https://cran.r-project.org/web/views/Cluster.html" class="external-link">CRAN Task View:
Cluster Analysis &amp; Finite Mixture Models</a>.</p>
<p>We use a hierarchical clustering using <code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust()</a></code> in this
example. It needs a distance matrix as the first argument and a linkage
method as the second one. Here, we use <code>method = "ward.D2"</code>,
which means that we are be using Ward’s minimum variance method that
minimizes the total within-cluster variance.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_hclust</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">landcover_dist</span>, method <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_hclust</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Graphical representation of the hierarchical clustering is called a
dendrogram. Based on the obtained dendrogram, we can divide our local
landscapes into a specified number of groups using
<code><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree()</a></code>. In this example, we use six classes
(<code>k = 6</code>) to make a result fairly straightforward to
understand.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">landcover_hclust</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>The <strong>motif</strong> package allows representing the clustering
results as either <code>sf</code> or <code>stars</code> object. This can
be done with the <code><a href="../reference/lsp_add_clusters.html">lsp_add_clusters()</a></code> function.</p>
<div class="section level3">
<h3 id="sf">
<code>sf</code><a class="anchor" aria-label="anchor" href="#sf"></a>
</h3>
<p>By the default, it creates a <code>sf</code> object with a new
variable <code>clust</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sf</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_clusters.html">lsp_add_clusters</a></span><span class="op">(</span><span class="va">landcover_cove</span>, <span class="va">clusters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sf</span><span class="op">[</span><span class="st">"clust"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">safe_pal6</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="section level4">
<h4 id="samples">Samples<a class="anchor" aria-label="anchor" href="#samples"></a>
</h4>
<p>Now, it is possible see some examples of each cluster.</p>
<p>For example, we can get id values of randomly selected local
landscapes from the first cluster.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sf_1</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">landcover_grid_sf</span>, <span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">landcover_grid_sf_1</span><span class="op">$</span><span class="va">id</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1146 1070 1376</span></span></code></pre></div>
<p>Next, we can extract them using <code><a href="../reference/lsp_extract.html">lsp_extract()</a></code>. This
cluster contains landscapes mostly covered by forest with small areas of
agriculture.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="fl">100</span>, id <span class="op">=</span> <span class="fl">1229</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="fl">100</span>, id <span class="op">=</span> <span class="fl">1237</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-15-2.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="fl">100</span>, id <span class="op">=</span> <span class="fl">687</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-15-3.png" width="672"></p>
<p>This approach can be used for any other cluster.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sf_6</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">landcover_grid_sf</span>, <span class="va">clust</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">landcover_grid_sf_6</span><span class="op">$</span><span class="va">id</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2579 2027 2577</span></span></code></pre></div>
<p>The sixth cluster is covered by frest, grassland, with smaller areas
of water and sparse vegetation.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="fl">100</span>, id <span class="op">=</span> <span class="fl">2098</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="fl">100</span>, id <span class="op">=</span> <span class="fl">2173</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-17-2.png" width="672"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="fl">100</span>, id <span class="op">=</span> <span class="fl">2172</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-17-3.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="quality">Quality<a class="anchor" aria-label="anchor" href="#quality"></a>
</h4>
<p>We can also calculate the quality of the clusterings with the
<code><a href="../reference/lsp_add_quality.html">lsp_add_quality()</a></code> function, which requires an output of
<code><a href="../reference/lsp_add_clusters.html">lsp_add_clusters()</a></code> as the first argument and output of
<code><a href="../reference/lsp_to_dist.html">lsp_to_dist()</a></code> as the second one. It adds three new
variables: <code>inhomogeneity</code>, <code>distinction</code>, and
<code>quality</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sfq</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_quality.html">lsp_add_quality</a></span><span class="op">(</span><span class="va">landcover_grid_sf</span>, <span class="va">landcover_dist</span><span class="op">)</span></span></code></pre></div>
<p>Inhomogeneity (<code>inhomogeneity</code>) measures a degree of
mutual dissimilarity between all objects in a cluster. This value is
between 0 and 1, where the small value indicates that all objects in the
cluster represent consistent patterns so the cluster is
pattern-homogeneous.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inhomogeneity_pal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">6</span>, palette <span class="op">=</span> <span class="st">"Emrld"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sfq</span><span class="op">[</span><span class="st">"inhomogeneity"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">inhomogeneity_pal</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>Distinction (<code>distinction</code>) is an average distance between
the focus cluster and all the other clusters. This value is between 0
and 1, where the large value indicates that the cluster stands out from
the rest of the clusters.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distinction_pal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">6</span>, palette <span class="op">=</span> <span class="st">"Teal"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sfq</span><span class="op">[</span><span class="st">"distinction"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">distinction_pal</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<p>Overall quality (<code>quality</code>) is calculated as
<code>1 - (inhomogeneity / distinction)</code>. This value is also
between 0 and 1, where increased values indicate increased quality of
clustering.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quality_pal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">6</span>, palette <span class="op">=</span> <span class="st">"Temps"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sfq</span><span class="op">[</span><span class="st">"quality"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">quality_pal</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="stars">
<code>stars</code><a class="anchor" aria-label="anchor" href="#stars"></a>
</h3>
<p>To create an <code>stars</code> object with a new attribute
<code>clust</code>, we must set <code>output = "stars"</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_stars</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_clusters.html">lsp_add_clusters</a></span><span class="op">(</span><span class="va">landcover_cove</span>, <span class="va">clusters</span>, output <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_stars</span><span class="op">[</span><span class="st">"clust"</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">safe_pal6</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>However, it is not yet possible to calculate the quality of the
clusterings for the <code>stars</code> objects:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_starsq</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_quality.html">lsp_add_quality</a></span><span class="op">(</span><span class="va">landcover_grid_stars</span>, <span class="va">landcover_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: This function requires an sf object as the x argument.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="irregular-local-landscapes">Irregular local landscapes<a class="anchor" aria-label="anchor" href="#irregular-local-landscapes"></a>
</h2>
<p>The <strong>motif</strong> package also allows for the clustering of
irregular regions based on the user-provided polygons. It has an example
spatial vector dataset, <code>ecoregions.gpkg</code>, which contains
terrestrial ecoregions for New Guinea from <a href="https://ecoregions2017.appspot.com/" class="external-link uri">https://ecoregions2017.appspot.com/</a>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecoregions</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"vector/ecoregions.gpkg"</span>, package <span class="op">=</span> <span class="st">"motif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This dataset has 22 rows, where each row relates to one ecoregion.
Each ecoregion is also related to a unique value in the <code>id</code>
column.</p>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
<p>The first step here is to calculate a signature for each ecoregion
using <code><a href="../reference/lsp_signature.html">lsp_signature()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_cove2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_signature.html">lsp_signature</a></span><span class="op">(</span><span class="va">landcover</span>, type <span class="op">=</span> <span class="st">"cove"</span>,</span>
<span>                                 window <span class="op">=</span> <span class="va">ecoregions</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span>, normalization <span class="op">=</span> <span class="st">"pdf"</span><span class="op">)</span></span></code></pre></div>
<p>Next step involves calculating distances between signatures of
ecoregions:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_dist2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_to_dist.html">lsp_to_dist</a></span><span class="op">(</span><span class="va">landcover_cove2</span>, dist_fun <span class="op">=</span> <span class="st">"jensen-shannon"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Metric: 'jensen-shannon' using unit: 'log2'; comparing: 22 vectors.</span></span></code></pre></div>
<p>Again, we find clusters using a hierarchical clustering:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_hclust2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">landcover_dist2</span>, method <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_hclust2</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
<p>This time, we divide the data into four clusters:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">landcover_hclust2</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sf-1">
<code>sf</code><a class="anchor" aria-label="anchor" href="#sf-1"></a>
</h3>
<p>Next steps are to add clusters ids to the <code>sf</code> object:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sf2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_clusters.html">lsp_add_clusters</a></span><span class="op">(</span><span class="va">landcover_cove2</span>, <span class="va">clusters2</span>,</span>
<span>                                      window <span class="op">=</span> <span class="va">ecoregions</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The results show that most area of New Guinea belongs to the second
clusters, with only one ecoregion of cluster 3 (small islands south from
New Guinea) and cluster 4.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sf2</span><span class="op">[</span><span class="st">"clust"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">safe_pal4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-35-1.png" width="672"></p>
<div class="section level4">
<h4 id="samples-1">Samples<a class="anchor" aria-label="anchor" href="#samples-1"></a>
</h4>
<p>The first cluser, for example, consists of nine ecoregions, from
which we sampled only three.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sf2_1</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">landcover_grid_sf2</span>, <span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">landcover_grid_sf2_1</span><span class="op">$</span><span class="va">id</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10  1 22</span></span></code></pre></div>
<p>Next, we can extract their land cover using
<code><a href="../reference/lsp_extract.html">lsp_extract()</a></code>. This cluster contains landscapes mostly
covered by forest with small areas of agriculture.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="va">ecoregions</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span>, id <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-38-1.png" width="672"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="va">ecoregions</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span>, id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-38-2.png" width="672"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lsp_extract.html">lsp_extract</a></span><span class="op">(</span><span class="va">landcover</span>, window <span class="op">=</span> <span class="va">ecoregions</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span>, id <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-38-3.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="quality-1">Quality<a class="anchor" aria-label="anchor" href="#quality-1"></a>
</h4>
<p>Final step involves calculating the quality metrics of the obtained
clusters:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_sfq2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_quality.html">lsp_add_quality</a></span><span class="op">(</span><span class="va">landcover_grid_sf2</span>, <span class="va">landcover_dist2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sfq2</span><span class="op">[</span><span class="st">"inhomogeneity"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">inhomogeneity_pal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-40-1.png" width="672"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sfq2</span><span class="op">[</span><span class="st">"distinction"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">distinction_pal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-41-1.png" width="672"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_sfq2</span><span class="op">[</span><span class="st">"quality"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">quality_pal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-42-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="stars-1">
<code>stars</code><a class="anchor" aria-label="anchor" href="#stars-1"></a>
</h3>
<p>To create a <code>stars</code> object with a new attribute
<code>clust</code>, we should set <code>output = "stars"</code>.
However, it is not yet possible to calculate the quality of the
clustering for the <code>stars</code> objects.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_grid_stars2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_add_clusters.html">lsp_add_clusters</a></span><span class="op">(</span><span class="va">landcover_cove2</span>, <span class="va">clusters2</span>, </span>
<span>                                         window <span class="op">=</span> <span class="va">ecoregions</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span>, output <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landcover_grid_stars2</span><span class="op">[</span><span class="st">"clust"</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">safe_pal4</span><span class="op">)</span></span>
<span><span class="co">#&gt; downsample set to 12</span></span></code></pre></div>
<p><img src="v5_cluster_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
